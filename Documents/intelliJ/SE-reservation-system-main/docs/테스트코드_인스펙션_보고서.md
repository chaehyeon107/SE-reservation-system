# 테스트 코드 인스펙션 보고서

## 프로젝트 정보
- **프로젝트명**: 전북대학교 7호관 무한상상실 예약 시스템
- **담당 기능**: 노트북 열람실 좌석 예약 조회 (SRS 3.1.2.4), 노트북 열람실 좌석 예약 취소 (SRS 3.1.2.3)
- **작성일**: 2025-12-20
- **테스트 프레임워크**: JUnit 5, Mockito, Spring Boot Test

---

## 1. 테스트 파일 개요

| 구분 | 파일명 | 테스트 수 | 테스트 유형 |
|------|--------|----------|------------|
| 유닛 테스트 | `SeatReservationQueryUnitTest.java` | 7개 | Service Layer 단위 테스트 |
| 유닛 테스트 | `SeatReservationCancelUnitTest.java` | 9개 | Service Layer 단위 테스트 |
| 컴포넌트 테스트 | `SeatReservationQueryCancelComponentTest.java` | 16개 | API 통합 테스트 |
| **합계** | - | **32개** | - |

---

## 2. 유닛 테스트 인스펙션

### 2.1 SeatReservationQueryUnitTest.java (예약 조회)

#### 테스트 대상
- **클래스**: `SeatReservationService`
- **메서드**: `getReservationsByStudentId(Long studentId)`

#### 테스트 구조
```
SeatReservationQueryUnitTest
├── BasicPathTest (기본 경로 테스트)
│   ├── TC_Q_01: 예약 1건 조회 성공
│   ├── TC_Q_02: 예약 여러 건 조회 성공
│   └── TC_Q_03: 예약 없음 - 빈 리스트 반환
├── ExceptionPathTest (예외 경로 테스트)
│   ├── TC_Q_04: 학번이 null인 경우 - INVALID_STUDENT_ID 예외
│   ├── TC_Q_05: 무효 학번 (202099999) - INVALID_STUDENT_ID 예외
│   └── TC_Q_06: 무효 학번 (202288888) - INVALID_STUDENT_ID 예외
└── ResponseValidationTest (반환값 검증 테스트)
    └── TC_Q_07: DTO 필드 매핑 검증
```

#### 테스트 케이스 상세

| TC ID | 테스트명 | 입력값 | 기대 결과 | 검증 항목 |
|-------|---------|--------|----------|----------|
| TC_Q_01 | 예약 1건 조회 성공 | studentId: 202111492 | List size = 1 | 반환 리스트 크기, Repository 호출 횟수 |
| TC_Q_02 | 예약 여러 건 조회 성공 | studentId: 202111492 | List size = 3 | 반환 리스트 크기, Repository 호출 횟수 |
| TC_Q_03 | 예약 없음 - 빈 리스트 반환 | studentId: 202111492 | Empty List | 빈 리스트 반환, Repository 호출 횟수 |
| TC_Q_04 | 학번 null 예외 | studentId: null | INVALID_STUDENT_ID | CustomException 발생, Repository 미호출 |
| TC_Q_05 | 무효 학번 예외 1 | studentId: 202099999 | INVALID_STUDENT_ID | CustomException 발생, Repository 미호출 |
| TC_Q_06 | 무효 학번 예외 2 | studentId: 202288888 | INVALID_STUDENT_ID | CustomException 발생, Repository 미호출 |
| TC_Q_07 | DTO 필드 매핑 검증 | 예약 객체 | DTO 필드 일치 | id, seatId, studentId, date, startTime, endTime |

#### 사용된 테스트 기법
- **Mock 객체**: `@Mock SeatReservationRepository`
- **의존성 주입**: `@InjectMocks SeatReservationService`
- **Stubbing**: `when().thenReturn()` 패턴
- **Verification**: `verify(repository, times(1))`, `verify(repository, never())`

#### 코드 품질 평가

| 항목 | 평가 | 비고 |
|------|------|------|
| 테스트 격리성 | 우수 | Mock 객체 사용으로 외부 의존성 완전 분리 |
| 테스트 명명 규칙 | 우수 | `TC_Q_XX_동작설명` 형식 일관성 유지 |
| Given-When-Then 패턴 | 우수 | 모든 테스트에서 AAA 패턴 준수 |
| 예외 검증 | 우수 | ErrorCode까지 정확히 검증 |
| 헬퍼 메서드 활용 | 우수 | `createMockSeatReservation()` 재사용 |

---

### 2.2 SeatReservationCancelUnitTest.java (예약 취소)

#### 테스트 대상
- **클래스**: `SeatReservationService`
- **메서드**: `cancelSeatReservation(Long reservationId, Long studentId)`

#### 테스트 구조
```
SeatReservationCancelUnitTest
├── BasicPathTest (기본 경로 테스트)
│   ├── TC_C_01: 예약 시작 전 취소 성공 - '시간 환급' 반환
│   ├── TC_C_02: 취소 시 예약 삭제(delete) 호출 확인
│   └── TC_C_03: 취소 시 사용 시간 환급 확인
├── StudentIdValidationTest (학번 검증 테스트)
│   ├── TC_C_04: 학번이 null인 경우 - INVALID_STUDENT_ID 예외
│   ├── TC_C_05: 무효 학번 (202099999) - INVALID_STUDENT_ID 예외
│   └── TC_C_06: 무효 학번 (202288888) - INVALID_STUDENT_ID 예외
└── ReservationValidationTest (예약 검증 테스트)
    ├── TC_C_07: 존재하지 않는 예약 ID - SEAT_RESERVATION_NOT_FOUND1 예외
    ├── TC_C_08: 타인 예약 취소 시도 - NO_CANCEL_PERMISSION1 예외
    └── TC_C_09: 이미 시작된 예약 취소 시도 - SEAT_ALREADY_IN_USE 예외
```

#### 테스트 케이스 상세

| TC ID | 테스트명 | 입력값 | 기대 결과 | 검증 항목 |
|-------|---------|--------|----------|----------|
| TC_C_01 | 취소 성공 - 시간 환급 | 미래 예약, 본인 학번 | "시간 환급" | 반환값 검증 |
| TC_C_02 | 예약 삭제 호출 확인 | 미래 예약, 본인 학번 | delete() 1회 호출 | Repository.delete() 호출 검증 |
| TC_C_03 | 사용 시간 환급 확인 | 2시간 예약 취소 | applySeatUsageDelta(-2) | Student 메서드 호출 검증 |
| TC_C_04 | 학번 null 예외 | studentId: null | INVALID_STUDENT_ID | CustomException, Repository 미호출 |
| TC_C_05 | 무효 학번 예외 1 | studentId: 202099999 | INVALID_STUDENT_ID | CustomException, Repository 미호출 |
| TC_C_06 | 무효 학번 예외 2 | studentId: 202288888 | INVALID_STUDENT_ID | CustomException, Repository 미호출 |
| TC_C_07 | 존재하지 않는 예약 | reservationId: 99999 | SEAT_RESERVATION_NOT_FOUND1 | CustomException, delete 미호출 |
| TC_C_08 | 타인 예약 취소 시도 | 타인의 예약 ID | NO_CANCEL_PERMISSION1 | CustomException, delete 미호출 |
| TC_C_09 | 이미 시작된 예약 | 과거 날짜 예약 | SEAT_ALREADY_IN_USE | CustomException, delete 미호출 |

#### 특수 설정
```java
@MockitoSettings(strictness = Strictness.LENIENT)
```
- **적용 이유**: Student Mock 객체의 spy 패턴 사용 시 불필요한 stubbing 경고 방지

#### 코드 품질 평가

| 항목 | 평가 | 비고 |
|------|------|------|
| 테스트 격리성 | 우수 | Mock/Spy 적절히 혼용 |
| 날짜 경계값 테스트 | 우수 | 미래/과거 날짜 케이스 분리 |
| 권한 검증 테스트 | 우수 | 본인/타인 예약 분리 |
| 상태 변경 검증 | 우수 | delete(), applySeatUsageDelta() 호출 검증 |
| 헬퍼 메서드 활용 | 우수 | createFutureReservationMock(), createPastReservationMock() |

---

## 3. 컴포넌트 테스트 인스펙션

### 3.1 SeatReservationQueryCancelComponentTest.java

#### 테스트 환경
```java
@ActiveProfiles("test")
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
```

#### MockMvc 설정 (Spring 업데이트 적용)
```java
private MockMvc mockMvc;
@Autowired private WebApplicationContext wac;

@BeforeEach
void setup() {
    this.mockMvc = webAppContextSetup(wac).build();
    // ...
}
```

#### 테스트 구조
```
SeatReservationQueryCancelComponentTest
├── SeatReservationQueryTest (좌석 예약 조회 - 5개)
│   ├── TC_SEAT_Q_01: 좌석 예약 조회 성공 - 예약이 1건 있는 경우
│   ├── TC_SEAT_Q_02: 좌석 예약 조회 성공 - 예약이 없는 경우 빈 리스트 반환
│   ├── TC_SEAT_Q_03: 좌석 예약 조회 성공 - 여러 건의 예약이 있는 경우
│   ├── TC_SEAT_Q_04: 좌석 예약 조회 - 다른 학생의 예약은 조회되지 않음
│   └── TC_SEAT_Q_05: 좌석 예약 조회 실패 - 무효 학번
└── SeatReservationCancelTest (좌석 예약 취소 - 11개)
    ├── TC_SEAT_C_01: 좌석 예약 취소 성공 - 예약 시작 전 (시간 환급)
    ├── TC_SEAT_C_02: 좌석 예약 취소 실패 - 존재하지 않는 예약
    ├── TC_SEAT_C_03: 좌석 예약 취소 실패 - 다른 사람의 예약 취소 시도
    ├── TC_SEAT_C_04: 좌석 예약 취소 후 좌석 예약 가능 상태 확인
    ├── TC_SEAT_C_05: 좌석 예약 취소 후 예약 조회 시 취소된 예약 미표시
    ├── TC_SEAT_C_06: 좌석 예약 취소 시 일일 사용 시간 환급 확인
    ├── TC_SEAT_C_07: 좌석 예약 취소 실패 - 이미 이용 시작된 예약
    ├── TC_SEAT_C_08: 좌석 예약 취소 실패 - 무효 학번
    ├── TC_SEAT_C_09: 날짜 경계값 - 다른 날짜 예약 취소 시 한도 리셋
    ├── TC_SEAT_C_10: 날짜 경계값 - 같은 날짜 취소 후 환급된 시간으로 재예약
    └── TC_SEAT_C_11: 날짜 경계값 - 날짜 변경 시 일일 한도 독립 관리
```

#### 조회 테스트 케이스 상세 (SeatReservationQueryTest)

| TC ID | 테스트명 | HTTP 메서드 | 엔드포인트 | 기대 상태 | 검증 항목 |
|-------|---------|------------|-----------|----------|----------|
| TC_SEAT_Q_01 | 예약 1건 조회 | GET | /api/seats/reservations | 200 OK | payload.length() = 1 |
| TC_SEAT_Q_02 | 예약 없음 조회 | GET | /api/seats/reservations | 200 OK | payload.length() = 0 |
| TC_SEAT_Q_03 | 여러 건 조회 | GET | /api/seats/reservations | 200 OK | payload.length() = 2 |
| TC_SEAT_Q_04 | 본인 예약만 조회 | GET | /api/seats/reservations | 200 OK | payload.length() = 1 |
| TC_SEAT_Q_05 | 무효 학번 조회 | GET | /api/seats/reservations | 400 Bad Request | errorCode = INVALID_STUDENT_ID |

#### 취소 테스트 케이스 상세 (SeatReservationCancelTest)

| TC ID | 테스트명 | HTTP 메서드 | 엔드포인트 | 기대 상태 | 검증 항목 |
|-------|---------|------------|-----------|----------|----------|
| TC_SEAT_C_01 | 취소 성공 | DELETE | /api/seats/reservations/{id} | 200 OK | payload = "시간 환급", DB 삭제 확인 |
| TC_SEAT_C_02 | 존재하지 않는 예약 | DELETE | /api/seats/reservations/{id} | 404 Not Found | errorCode = SEAT_RESERVATION_NOT_FOUND1 |
| TC_SEAT_C_03 | 권한 없음 | DELETE | /api/seats/reservations/{id} | 403 Forbidden | errorCode = NO_CANCEL_PERMISSION1 |
| TC_SEAT_C_04 | 취소 후 재예약 가능 | DELETE + POST | - | 200 OK | 새 예약 생성 성공 |
| TC_SEAT_C_05 | 취소 후 조회 미표시 | DELETE + GET | - | 200 OK | 취소된 예약 제외됨 |
| TC_SEAT_C_06 | 일일 사용 시간 환급 | DELETE + POST | - | 200 OK | 환급 후 추가 예약 가능 |
| TC_SEAT_C_07 | 이미 시작된 예약 | DELETE | /api/seats/reservations/{id} | 400 Bad Request | errorCode = SEAT_ALREADY_IN_USE |
| TC_SEAT_C_08 | 무효 학번 취소 | DELETE | /api/seats/reservations/{id} | 400 Bad Request | errorCode = INVALID_STUDENT_ID |
| TC_SEAT_C_09 | 날짜 경계값 - 한도 리셋 | DELETE + GET | - | 200 OK | 다른 날짜 예약 유지 |
| TC_SEAT_C_10 | 날짜 경계값 - 재예약 | DELETE + POST | - | 200 OK | 환급 후 같은 날 재예약 |
| TC_SEAT_C_11 | 날짜 경계값 - 독립 한도 | POST + GET | - | 200 OK | 날짜별 한도 독립 관리 |

#### 코드 품질 평가

| 항목 | 평가 | 비고 |
|------|------|------|
| 테스트 격리성 | 우수 | @BeforeEach에서 DB 초기화 |
| API 응답 검증 | 우수 | status(), jsonPath() 활용 |
| DB 상태 검증 | 우수 | Repository 직접 조회로 확인 |
| 날짜 경계값 테스트 | 우수 | resetSeatIfNeeded 로직 검증 |
| 헬퍼 메서드 활용 | 우수 | createSeatReservation() 재사용 |
| HTTP 상태 코드 검증 | 우수 | 200, 400, 403, 404 정확히 구분 |

---

## 4. 테스트 커버리지 분석

### 4.1 요구사항 대비 커버리지

#### SRS 3.1.2.4 노트북 열람실 예약 조회

| 요구사항 | 유닛 테스트 | 컴포넌트 테스트 | 커버리지 |
|----------|------------|----------------|----------|
| 학번으로 예약 조회 | TC_Q_01, TC_Q_02, TC_Q_03 | TC_SEAT_Q_01, TC_SEAT_Q_02, TC_SEAT_Q_03 | 100% |
| 본인 예약만 조회 | - | TC_SEAT_Q_04 | 100% |
| 무효 학번 예외 처리 | TC_Q_04, TC_Q_05, TC_Q_06 | TC_SEAT_Q_05 | 100% |
| DTO 필드 매핑 | TC_Q_07 | - | 100% |

#### SRS 3.1.2.3 노트북 열람실 예약 취소

| 요구사항 | 유닛 테스트 | 컴포넌트 테스트 | 커버리지 |
|----------|------------|----------------|----------|
| 예약 취소 성공 (시간 환급) | TC_C_01 | TC_SEAT_C_01 | 100% |
| 예약 삭제 처리 | TC_C_02 | TC_SEAT_C_01 | 100% |
| 사용 시간 환급 | TC_C_03 | TC_SEAT_C_06 | 100% |
| 무효 학번 예외 | TC_C_04, TC_C_05, TC_C_06 | TC_SEAT_C_08 | 100% |
| 존재하지 않는 예약 예외 | TC_C_07 | TC_SEAT_C_02 | 100% |
| 권한 없음 예외 | TC_C_08 | TC_SEAT_C_03 | 100% |
| 이미 시작된 예약 예외 | TC_C_09 | TC_SEAT_C_07 | 100% |
| 취소 후 좌석 재예약 가능 | - | TC_SEAT_C_04 | 100% |
| 날짜별 일일 한도 관리 | - | TC_SEAT_C_09, TC_SEAT_C_10, TC_SEAT_C_11 | 100% |

### 4.2 ErrorCode 커버리지

| ErrorCode | 유닛 테스트 | 컴포넌트 테스트 |
|-----------|------------|----------------|
| INVALID_STUDENT_ID | TC_Q_04~06, TC_C_04~06 | TC_SEAT_Q_05, TC_SEAT_C_08 |
| SEAT_RESERVATION_NOT_FOUND1 | TC_C_07 | TC_SEAT_C_02 |
| NO_CANCEL_PERMISSION1 | TC_C_08 | TC_SEAT_C_03 |
| SEAT_ALREADY_IN_USE | TC_C_09 | TC_SEAT_C_07 |
| SEAT_DAILY_LIMIT_EXCEEDED | - | TC_SEAT_C_10 |

---

## 5. 인스펙션 결과 요약

### 5.1 강점

1. **체계적인 테스트 구조**
   - Nested 클래스로 테스트 케이스 논리적 그룹화
   - 일관된 명명 규칙 (TC_Q_XX, TC_C_XX, TC_SEAT_Q_XX, TC_SEAT_C_XX)

2. **높은 테스트 커버리지**
   - 요구사항 명세서의 모든 기능 커버
   - 기본 경로 + 예외 경로 모두 테스트

3. **적절한 Mock 활용**
   - 유닛 테스트: Repository Mock으로 DB 의존성 제거
   - 컴포넌트 테스트: 실제 H2 DB 사용으로 통합 검증

4. **날짜 경계값 테스트**
   - resetSeatIfNeeded() 로직 검증
   - 일일 한도 독립 관리 검증

5. **Spring 최신 권장 패턴 적용**
   - WebApplicationContext를 통한 MockMvc 수동 설정

### 5.2 테스트 실행 결과

```
./gradlew clean test --tests "*Query*" --tests "*Cancel*"

SeatReservationQueryUnitTest    : 7개 PASSED
SeatReservationCancelUnitTest   : 9개 PASSED
SeatReservationQueryCancelComponentTest : 16개 PASSED
─────────────────────────────────────────────
총 32개 테스트 모두 통과
```

---

## 6. 파일 위치

```
src/test/java/com/example/reservationsystem/
├── SeatReservationQueryUnitTest.java          # 조회 유닛 테스트 (7개)
├── SeatReservationCancelUnitTest.java         # 취소 유닛 테스트 (9개)
└── SeatReservationQueryCancelComponentTest.java  # 조회/취소 컴포넌트 테스트 (16개)
```

---

## 7. 결론

노트북 열람실 좌석 예약 조회 및 취소 기능에 대해 **총 32개의 테스트 케이스**를 작성하여 요구사항 명세서(SRS 3.1.2.3, 3.1.2.4)의 모든 기능을 검증하였습니다.

- **유닛 테스트 16개**: Service 계층의 비즈니스 로직 검증
- **컴포넌트 테스트 16개**: Controller-Service-Repository 통합 검증

모든 테스트가 통과하며, 코드 품질 및 테스트 커버리지가 우수한 수준입니다.
